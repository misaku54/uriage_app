<% provide(:title, '月別売上集計') %>

<%= render 'shared/error_messages', object: @search_params %>
<div class="well">
  <p>月別売上集計</p>
  <%= form_with(url: user_monthly_search_path(@user), method: "get", class: "form-inline") do |f| %>
    <div class="form-group">
      <%= f.label :date, '集計月', class: 'control-label' %>
      <%== sprintf(f.date_select(:date, {  use_month_numbers: true, start_year: Time.now.year, 
                                    end_year: 2022, discard_day: true, date_separator: '%s', selected: Date.today}, class:'form-control'),'年') + '月'%>
    </div>
    <div class="form-group">
      <%= f.submit '集計する', class: "btn btn-info" %>
    </div>
  <% end %>
</div>

  <p><%= search_result_title(@search_params) %></p>

<% if @sales_total_amount.present? %>
  <div class="panel panel-primary">
    <div class="panel-heading">
      <h4>合計純売上</h4>
    </div>
    <div class="panel-body">
      <h4><%= add_en(@sales_total_amount) %></h4>
    </div>
  </div>
<% end %>
<% if @sales_trend.present? %>
  <div class="panel panel-primary">
    <div class="panel-heading">
      <h4>売上推移</h4>
    </div>
    <div class="panel-body">
      <%= line_chart @sales_trend , suffix: "円", thousands: "," %>
    </div>
  </div>
<% end %>
<% if @aggregates_of_maker_producttype.present? %>
  <%= render 'card', aggregates: @aggregates_of_maker_producttype, card_pattern: "maker_producttype" %>
<% end %>
<% if @aggregates_of_maker.present? %>
  <%= render 'card', aggregates: @aggregates_of_maker, card_pattern: "maker" %>
<% end %>
<% if @aggregates_of_producttype.present? %>
  <%= render 'card', aggregates: @aggregates_of_producttype, card_pattern: "producttype" %>
<% end %>
